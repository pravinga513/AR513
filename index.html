<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VingaDeck Studio | AR Business Card Creator</title>
    
    <!-- Frameworks & Styles -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Lucide Icons (via CDN) -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Exo+2:ital,wght@0,400;0,700;0,900;1,900&display=swap');
        
        body { font-family: 'Exo 2', sans-serif; }
        .perspective-1000 { perspective: 1000px; }
        .rotate-x-60 { transform: rotateX(60deg); }
        .animate-spin-slow { animation: spin 12s linear infinite; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        
        @media print {
            .no-print { display: none !important; }
            .print-area { display: block !important; position: absolute; top: 0; left: 0; width: 100%; }
            #card-front, #card-back { 
                box-shadow: none !important; 
                border: 3px solid #000 !important;
                margin: 40px auto !important;
                page-break-inside: avoid;
            }
        }

        input[type="range"] { appearance: none; background: #27272a; height: 6px; border-radius: 5px; }
        input[type="range"]::-webkit-slider-thumb {
            appearance: none; width: 18px; height: 18px; background: #eab308;
            border-radius: 50%; cursor: pointer; border: 3px solid #09090b;
        }
    </style>
</head>
<body class="bg-zinc-950 text-zinc-100">
    <div id="root"></div>

    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        // Global Firebase Config (Replace with your own keys for deployment)
        const firebaseConfig = window.__firebase_config ? JSON.parse(window.__firebase_config) : {
            apiKey: "",
            authDomain: "",
            projectId: "",
            storageBucket: "",
            messagingSenderId: "",
            appId: ""
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const appId = window.__app_id || 'vingadeck-studio';

        window.VingaFirebase = { auth, db, appId, doc, setDoc, getDoc, signInAnonymously, onAuthStateChanged };
    </script>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Custom Icon Component (SVG based for reliability in single file)
        const Icon = ({ name, size = 16, className = "" }) => {
            return <i data-lucide={name} style={{ width: size, height: size }} className={className}></i>;
        };

        const App = () => {
            const [view, setView] = useState('create'); 
            const [tab, setTab] = useState('ar'); 
            const [loading, setLoading] = useState(false);
            const [saveStatus, setSaveStatus] = useState('');
            const [cardId, setCardId] = useState(Math.random().toString(36).substring(2, 9).toUpperCase());
            
            const [data, setData] = useState({
                cardHolder: "PRAVINGA 513",
                brandTitle: "PG513 UNIVERSE",
                cardColor: "#ffffff",
                textColor: "#000000",
                profilePic: "https://api.dicebear.com/7.x/avataaars/svg?seed=Pravinga",
                arTitle: "PRAVINGA 513",
                arSubtitle: "Interactive Universe",
                themeColor: "#FFD700",
                panelOpacity: 0.9,
                tiltAngle: -60,
                links: [
                    { label: "INSTAGRAM", url: "https://instagram.com/pravinga513", color: "#E1306C" },
                    { label: "YOUTUBE", url: "https://youtube.com/@games513", color: "#FF0000" }
                ]
            });

            useEffect(() => {
                if (window.lucide) window.lucide.createIcons();
            }, [tab, view]);

            useEffect(() => {
                const params = new URLSearchParams(window.location.search);
                const id = params.get('id');
                const mode = params.get('view');
                if (id) {
                    setCardId(id);
                    if (window.VingaFirebase) loadCardData(id);
                    if (mode === 'ar') setView('live-ar');
                }
            }, []);

            const loadCardData = async (id) => {
                const { db, appId, doc, getDoc } = window.VingaFirebase;
                setLoading(true);
                try {
                    const docRef = doc(db, 'artifacts', appId, 'public', 'data', 'cards', id);
                    const docSnap = await getDoc(docRef);
                    if (docSnap.exists()) setData(docSnap.data());
                } catch (e) { console.error(e); }
                setLoading(false);
            };

            const saveCard = async () => {
                const { auth, db, appId, doc, setDoc, signInAnonymously } = window.VingaFirebase;
                setLoading(true);
                setSaveStatus('Saving...');
                try {
                    if (!auth.currentUser) await signInAnonymously(auth);
                    const docRef = doc(db, 'artifacts', appId, 'public', 'data', 'cards', cardId);
                    await setDoc(docRef, { ...data, updatedAt: new Date().toISOString() });
                    setSaveStatus('Experience Saved!');
                    setTimeout(() => setSaveStatus(''), 3000);
                } catch (e) { setSaveStatus('Save Error'); }
                setLoading(false);
            };

            const updateField = (field, value) => setData(prev => ({ ...prev, [field]: value }));
            
            const updateLink = (index, field, value) => {
                const newLinks = [...data.links];
                newLinks[index][field] = value;
                setData({ ...data, links: newLinks });
            };

            const cardPublicUrl = `${window.location.origin}${window.location.pathname}?view=ar&id=${cardId}`;
            const qrCodeUrl = `https://api.qrserver.com/v1/create-qr-code/?data=${encodeURIComponent(cardPublicUrl)}&size=300x300&bgcolor=ffffff`;

            if (view === 'live-ar') {
                return (
                    <div className="w-full h-screen bg-black flex flex-col">
                        <div className="absolute top-4 left-4 z-50">
                            <button onClick={() => setView('create')} className="bg-zinc-900/80 backdrop-blur-md text-white px-5 py-2.5 rounded-xl text-sm font-bold border border-white/10">
                                ← Exit AR View
                            </button>
                        </div>
                        <iframe 
                            srcDoc={`
                                <!DOCTYPE html>
                                <html>
                                    <head>
                                        <script src="https://aframe.io/releases/1.3.0/aframe.min.js"><\/script>
                                        <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"><\/script>
                                    </head>
                                    <body style="margin: 0; overflow: hidden;">
                                        <script>
                                            AFRAME.registerComponent('link-to', {
                                                schema: { url: {type: 'string'} },
                                                init: function () {
                                                    this.el.addEventListener('click', () => { window.open(this.data.url, '_blank'); });
                                                }
                                            });
                                        <\/script>
                                        <a-scene embedded arjs="debugUIEnabled: false;">
                                            <a-marker preset="hiro">
                                                <a-entity position="0 0.5 -0.8" rotation="${data.tiltAngle} 0 0">
                                                    <a-plane width="3.2" height="2.2" color="#050505" opacity="${data.panelOpacity}" transparent="true">
                                                        <a-image src="${data.profilePic}" position="0 0.8 0.1" width="0.5" height="0.5"></a-image>
                                                        <a-text value="${data.arTitle}" align="center" position="0 0.4 0.1" color="${data.themeColor}" width="5"></a-text>
                                                        <a-text value="${data.arSubtitle}" align="center" position="0 0.1 0.1" color="white" width="3"></a-text>
                                                        <a-entity position="0 -0.4 0.1">
                                                            ${data.links.map((link, i) => `
                                                                <a-plane class="clickable" link-to="url: ${link.url}" position="${(i % 2 === 0 ? -0.8 : 0.8)} ${-Math.floor(i / 2) * 0.45} 0" width="1.4" height="0.35" color="${link.color}">
                                                                    <a-text value="${link.label}" align="center" color="white" width="2.5"></a-text>
                                                                </a-plane>
                                                            `).join('')}
                                                        </a-entity>
                                                    </a-plane>
                                                </a-entity>
                                            </a-marker>
                                            <a-entity camera><a-entity cursor="rayOrigin: mouse" raycaster="objects: .clickable"></a-entity></a-entity>
                                        </a-scene>
                                    </body>
                                </html>
                            `}
                            className="flex-1 border-none"
                            allow="camera"
                        />
                    </div>
                );
            }

            return (
                <div className="min-h-screen flex flex-col">
                    <header className="border-b border-zinc-800 p-4 bg-zinc-900 sticky top-0 z-40 flex justify-between items-center no-print">
                        <div className="flex items-center gap-2">
                            <div className="bg-yellow-500 p-1.5 rounded-lg shadow-lg">
                                <Icon name="layers" size={20} className="text-black" />
                            </div>
                            <h1 className="font-black text-lg">VINGADECK <span className="text-yellow-500">STUDIO</span></h1>
                        </div>
                        <div className="flex items-center gap-3">
                            <span className="text-[10px] text-yellow-500 font-bold uppercase">{saveStatus}</span>
                            <button onClick={saveCard} className="bg-zinc-800 border border-zinc-700 px-4 py-2 rounded-lg text-sm font-bold flex items-center gap-2">
                                <Icon name="save" size={16} /> Save
                            </button>
                            <button onClick={() => window.print()} className="bg-yellow-600 text-white px-4 py-2 rounded-lg text-sm font-black flex items-center gap-2">
                                <Icon name="printer" size={16} /> Print
                            </button>
                        </div>
                    </header>

                    <main className="flex-1 flex flex-col md:flex-row overflow-hidden">
                        <aside className="w-full md:w-96 border-r border-zinc-800 bg-zinc-900/50 flex flex-col overflow-y-auto no-print">
                            <div className="flex border-b border-zinc-800">
                                <button onClick={() => setTab('physical')} className={`flex-1 py-4 text-[10px] font-bold uppercase tracking-widest ${tab === 'physical' ? 'text-yellow-500 border-b-2 border-yellow-500 bg-zinc-800/50' : 'text-zinc-500'}`}>Design</button>
                                <button onClick={() => setTab('ar')} className={`flex-1 py-4 text-[10px] font-bold uppercase tracking-widest ${tab === 'ar' ? 'text-yellow-500 border-b-2 border-yellow-500 bg-zinc-800/50' : 'text-zinc-500'}`}>3D AR</button>
                            </div>

                            <div className="p-6 space-y-6">
                                {tab === 'physical' ? (
                                    <div className="space-y-4">
                                        <h3 className="text-[10px] font-black uppercase text-zinc-500">Physical Card</h3>
                                        <input value={data.cardHolder} onChange={e => updateField('cardHolder', e.target.value)} className="w-full bg-zinc-800 border border-zinc-700 rounded-lg p-3 text-sm outline-none" placeholder="Name" />
                                        <input value={data.brandTitle} onChange={e => updateField('brandTitle', e.target.value)} className="w-full bg-zinc-800 border border-zinc-700 rounded-lg p-3 text-sm outline-none" placeholder="Brand" />
                                        <input value={data.profilePic} onChange={e => updateField('profilePic', e.target.value)} className="w-full bg-zinc-800 border border-zinc-700 rounded-lg p-3 text-sm outline-none" placeholder="Profile Image URL" />
                                        <div className="grid grid-cols-2 gap-4">
                                            <input type="color" value={data.cardColor} onChange={e => updateField('cardColor', e.target.value)} className="w-full h-10 rounded-lg bg-zinc-800 border border-zinc-700 cursor-pointer" />
                                            <input type="color" value={data.textColor} onChange={e => updateField('textColor', e.target.value)} className="w-full h-10 rounded-lg bg-zinc-800 border border-zinc-700 cursor-pointer" />
                                        </div>
                                    </div>
                                ) : (
                                    <div className="space-y-4">
                                        <h3 className="text-[10px] font-black uppercase text-zinc-500">AR Hologram</h3>
                                        <input value={data.arTitle} onChange={e => updateField('arTitle', e.target.value)} className="w-full bg-zinc-800 border border-zinc-700 rounded-lg p-3 text-sm outline-none" placeholder="3D Title" />
                                        <input value={data.arSubtitle} onChange={e => updateField('arSubtitle', e.target.value)} className="w-full bg-zinc-800 border border-zinc-700 rounded-lg p-3 text-sm outline-none" placeholder="3D Subtitle" />
                                        <div className="flex justify-between items-center text-[10px] text-zinc-500 uppercase font-black">
                                            <span>Tilt Angle</span>
                                            <span className="text-yellow-500">{data.tiltAngle}°</span>
                                        </div>
                                        <input type="range" min="-90" max="0" step="5" value={data.tiltAngle} onChange={e => updateField('tiltAngle', parseInt(e.target.value))} className="w-full" />
                                    </div>
                                )}
                            </div>
                        </aside>

                        <section className="flex-1 bg-zinc-950 flex flex-col items-center justify-center p-6 relative overflow-y-auto">
                            <div className="no-print absolute top-8 text-center">
                                <h2 className="text-zinc-500 text-[10px] font-black uppercase tracking-[0.4em] mb-1">Canvas Engine</h2>
                                <p className="text-zinc-400 text-xs font-medium">Previewing {tab === 'physical' ? 'Printable Layout' : '3D Overlay'}</p>
                            </div>

                            <div className="relative group perspective-1000 mt-12 print-area">
                                {tab === 'physical' ? (
                                    <div className="flex flex-col gap-8 items-center">
                                        <div id="card-front" className="w-[340px] h-[200px] rounded-2xl shadow-2xl relative overflow-hidden flex flex-col p-8 transition-all duration-500" style={{ backgroundColor: data.cardColor, color: data.textColor }}>
                                            <div className="flex items-center gap-4 mb-4">
                                                <img src={data.profilePic} className="w-12 h-12 rounded-xl border border-current/10 bg-white/10 shadow-lg object-cover" />
                                                <div className="space-y-0.5">
                                                    <h2 className="text-2xl font-black italic tracking-tighter uppercase">{data.cardHolder}</h2>
                                                    <p className="text-[8px] opacity-70 uppercase tracking-[0.2em] font-bold">{data.brandTitle}</p>
                                                </div>
                                            </div>
                                            <div className="flex-1"></div>
                                            <div className="flex justify-between items-end pt-4 border-t border-current/10">
                                                <div className="text-[8px] font-mono opacity-40">SYSTEM-ID: {cardId}</div>
                                                <div className="w-8 h-8 bg-current/5 rounded-lg flex items-center justify-center font-black text-xs">513</div>
                                            </div>
                                        </div>

                                        <div id="card-back" className="w-[340px] h-[200px] bg-white rounded-2xl shadow-2xl relative overflow-hidden flex items-center p-6 border-2 border-zinc-200/50">
                                            <div className="w-[140px] h-[140px] bg-black p-4 rounded-xl flex items-center justify-center shrink-0">
                                                <div className="w-full h-full bg-white p-3 flex flex-col items-center justify-center relative rounded-lg">
                                                    <img src={qrCodeUrl} className="w-full h-auto" />
                                                    <div className="absolute -bottom-1 text-[7px] font-black text-black tracking-tighter uppercase">SCAN AR</div>
                                                </div>
                                            </div>
                                            <div className="flex-1 pl-6 space-y-4">
                                                <div>
                                                    <h4 className="text-black text-[9px] font-black uppercase mb-1 tracking-widest opacity-40 italic">Operation</h4>
                                                    <p className="text-black text-[8px] leading-relaxed font-bold opacity-70">
                                                        1. Scan QR Code<br/>
                                                        2. Allow Camera<br/>
                                                        3. Point at Hiro Marker
                                                    </p>
                                                </div>
                                                <div className="pt-4 border-t border-zinc-100">
                                                    <div className="text-black text-[14px] font-black italic tracking-tighter">VingaDeck Studio</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                ) : (
                                    <div className="relative w-[340px] h-[480px] flex items-center justify-center select-none perspective-1000">
                                        <div className="absolute bottom-20 w-44 h-44 bg-black/40 p-4 rounded-2xl rotate-x-60 backdrop-blur-md border border-white/10 shadow-2xl flex items-center justify-center font-black text-white/10">HIRO</div>
                                        <div className="w-80 h-56 rounded-3xl shadow-[0_0_80px_rgba(255,255,255,0.05)] flex flex-col p-6 border transition-all duration-700 ease-out" style={{ backgroundColor: '#030303', borderColor: data.themeColor, transform: `rotateX(${data.tiltAngle}deg) translateY(-100px) scale(1.1)`, opacity: data.panelOpacity }}>
                                            <h3 className="text-2xl font-black italic text-center mb-1 tracking-tighter uppercase" style={{ color: data.themeColor }}>{data.arTitle}</h3>
                                            <p className="text-[9px] text-center text-zinc-400 mb-6 uppercase tracking-[0.3em] font-bold">{data.arSubtitle}</p>
                                            <div className="grid grid-cols-2 gap-3 mt-auto">
                                                <div className="h-8 rounded-xl flex items-center justify-center text-[7px] font-black tracking-widest uppercase truncate px-2 text-white bg-pink-600">Instagram</div>
                                                <div className="h-8 rounded-xl flex items-center justify-center text-[7px] font-black tracking-widest uppercase truncate px-2 text-white bg-red-600">YouTube</div>
                                            </div>
                                        </div>
                                    </div>
                                )}
                            </div>

                            <div className="no-print absolute bottom-12 flex flex-col sm:flex-row gap-4 w-full px-8 justify-center items-center">
                                <button onClick={() => setView('live-ar')} className="bg-zinc-800 text-white text-xs px-8 py-3.5 rounded-full flex items-center gap-2 border border-zinc-700 transition-all font-bold shadow-2xl active:scale-95">
                                    <Icon name="smartphone" size={16} /> Launch AR Camera
                                </button>
                                <a href={cardPublicUrl} target="_blank" className="bg-yellow-600/10 text-yellow-500 text-xs px-8 py-3.5 rounded-full flex items-center gap-2 border border-yellow-500/30 transition-all font-bold">
                                    <Icon name="external-link" size={16} /> Public Link
                                </a>
                            </div>
                        </section>
                    </main>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
